<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Speedpaint Giveaway</title>
  <style type="text/css">
    body {
      /*background: #0B161D;*/
      background: #252525;
      color: white;
    }

    button {
      padding: 0.5em;
      width: 100%;
    }
  </style>
</head>
<body>

<a id="auth-link" href="#" target="_top"><button id="authorize-btn">Authorize with Bot Account</button></a>

<script type="module">
  // Bring in our websocket library.
  const getWebSocket = require('./websocket');

  // Alter the link and text for the authorize button so that if the user is
  // authorized it will display their name and offer to deauthorize, and
  // otherwise it will invite them to auth themselves.
  function setupAuthButton(authorized, username) {
    const authLink = document.getElementById('auth-link');
    const authBtn = document.getElementById('authorize-btn');

    authBtn.innerText = authorized ? `Deauthorize ${username}` : 'Authorize with Twitch';
    authLink.href = authorized ? '/deauth' : '/auth';
  }

  // By default, assume we're not authorized until we learn differently.
  setupAuthButton(false);

  // Connected to the server.
  const socket = getWebSocket(location.hostname, 4040);

  // When the twitch authorization state changes, alter the link and text of the
  // button to suit.
  socket.on("twitch-auth", data => {
    setupAuthButton(data.authorized, data.userName);
  });
</script>
</body>
</html>